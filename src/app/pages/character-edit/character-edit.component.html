<div class="container-fluid">
  <app-loading *ngIf="loading; else editTemplate"></app-loading>
</div>

<ng-template #editTemplate>
  <button
    mat-raised-button
    color="primary"
    class="mt-1 mb-1"
    (click)="toCharacters()"
    i18n
  >
    <em class="material-icons">arrow_back</em> {{ 'Common.Back' | translate }}
  </button>
  <mat-card class="mb-2">
    <mat-card-header>{{
      'Edits.AboutCharacterEditing' | translate
    }}</mat-card-header>
    <mat-card-content>
      {{ 'Edits.CharacterEditingInfo' | translate }}
    </mat-card-content>
  </mat-card>
  <mat-card class="h-100">
    <mat-card-header>
      <mat-card-title>
        <h2 class="d-inline">
          <img
            *ngIf="character.stockIcon"
            [src]="character.stockIcon.url"
            alt="stock icon"
          />
          {{ character.name }}
        </h2>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content class="h-100">
      <mat-tab-group class="h-100">
        <mat-tab
          class="h-100"
          [label]="'Characters.GeneralInformation' | translate"
        >
          <mat-form-field class="general-information">
            <textarea
              matInput
              [placeholder]="
                'Characters.GeneralInformationAboutTheCharacter' | translate
              "
              [(ngModel)]="character.generalInformation"
              type="textarea"
              class="general-information"
              name="generalInformation"
            ></textarea>
          </mat-form-field>
        </mat-tab>
        <mat-tab
          class="h-100"
          [label]="'Characters.NotablePlayers' | translate"
        >
          <div class="row">
            <div class="col-12">
              <button
                class="create-button"
                mat-raised-button
                (click)="createPlayer()"
                color="primary"
                i18n
              >
                <em class="material-icons">add</em>
                {{ 'Characters.NewPlayer' | translate }}
              </button>
            </div>
            <div class="col-12">
              <p *ngIf="character.notablePlayers.length === 0" i18n>
                {{ 'Characters.NoPlayersYet' | translate }}
              </p>
              <div
                *ngFor="let player of character.notablePlayers"
                class="player"
              >
                <mat-form-field class="name">
                  <input
                    matInput
                    [placeholder]="'Common.Name' | translate"
                    [(ngModel)]="player.name"
                    type="input"
                    [name]="'playerName' + player.id"
                    [readonly]="!player.new"
                    [disabled]="!player.new"
                  />
                </mat-form-field>
                <mat-form-field class="country">
                  <input
                    maxlength="2"
                    matInput
                    [placeholder]="'Characters.Country' | translate"
                    [(ngModel)]="player.country"
                    (ngModelChange)="
                      player.country = player.country.toLowerCase()
                    "
                    type="input"
                    [name]="'playerDescription' + player.id"
                    [readonly]="!player.new"
                    [disabled]="!player.new"
                  />
                </mat-form-field>
                <span
                  *ngIf="player.country"
                  [class]="'flag flag-icon flag-icon-' + player.country"
                ></span>
                <mat-form-field class="description">
                  <input
                    matInput
                    [placeholder]="'Common.Description' | translate"
                    [(ngModel)]="player.description"
                    type="input"
                    [name]="'playerDescription' + player.id"
                    [readonly]="!player.new"
                    [disabled]="!player.new"
                  />
                </mat-form-field>
                <button
                  class="delete-button"
                  mat-button
                  color="accent"
                  (click)="deletePlayer(player)"
                  i18n
                >
                  <em class="material-icons">delete</em>
                  {{ 'Common.Delete' | translate }}
                </button>
                <hr />
              </div>
            </div>
          </div>
        </mat-tab>
        <mat-tab class="h-100" [label]="'Characters.Videos' | translate">
          <span [innerHTML]="'Characters.AboutYouTubeIds' | translate"></span>
          <div class="row">
            <div class="col-12">
              <button
                class="create-button"
                mat-raised-button
                (click)="createVideo()"
                color="primary"
                i18n
              >
                <em class="material-icons">add</em>
                {{ 'Characters.NewVideo' | translate }}
              </button>
            </div>
            <div class="col-12">
              <p *ngIf="character.videos.length === 0" i18n>
                {{ 'Characters.NoVideosYet' | translate }}
              </p>
              <div *ngFor="let video of character.videos" class="player">
                <mat-form-field class="name">
                  <input
                    matInput
                    [placeholder]="'Common.Name' | translate"
                    [(ngModel)]="video.name"
                    type="input"
                    [name]="'videoName' + video.id"
                    required
                    [readonly]="!video.new"
                    [disabled]="!video.new"
                  />
                </mat-form-field>
                <mat-form-field class="description">
                  <input
                    matInput
                    [placeholder]="'Characters.YouTubeId' | translate"
                    [(ngModel)]="video.youtubeId"
                    type="input"
                    [name]="'youtubeId' + video.id"
                    required
                    [readonly]="!video.new"
                    [disabled]="!video.new"
                  />
                </mat-form-field>
                <button
                  class="delete-button"
                  mat-button
                  color="accent"
                  (click)="deleteVideo(video)"
                  i18n
                >
                  <em class="material-icons">delete</em>
                  {{ 'Common.Delete' | translate }}
                </button>
                <hr />
              </div>
            </div>
          </div>
        </mat-tab>
        <mat-tab class="h-100" [label]="'Characters.Websites' | translate">
          <div class="row">
            <div class="col-12">
              <button
                class="create-button"
                mat-raised-button
                (click)="createWebsite()"
                color="primary"
                i18n
              >
                <em class="material-icons">add</em>
                {{ 'Characters.NewWebsite' | translate }}
              </button>
            </div>
            <div class="col-12">
              <p *ngIf="character.websites.length === 0" i18n>
                {{ 'Characters.NoWebsitesYet' | translate }}
              </p>
              <div *ngFor="let websites of character.websites" class="player">
                <mat-form-field class="name">
                  <input
                    matInput
                    [placeholder]="'Common.Title' | translate"
                    [(ngModel)]="websites.title"
                    type="input"
                    [name]="'websiteName' + websites.id"
                    required
                    [readonly]="!websites.new"
                    [disabled]="!websites.new"
                  />
                </mat-form-field>
                <mat-form-field class="description">
                  <input
                    matInput
                    [placeholder]="'Characters.Url' | translate"
                    [(ngModel)]="websites.websiteUrl"
                    type="input"
                    [name]="'websitesUrl' + websites.id"
                    required
                    [readonly]="!websites.new"
                    [disabled]="!websites.new"
                  />
                </mat-form-field>
                <button
                  class="delete-button"
                  mat-button
                  color="accent"
                  (click)="deleteWebsite(websites)"
                  i18n
                >
                  <em class="material-icons">delete</em>
                  {{ 'Common.Delete' | translate }}
                </button>
                <hr />
              </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
    <mat-card-actions>
      <button mat-raised-button color="primary" (click)="saveForm()" i18n>
        <em class="material-icons">save</em> {{ 'Common.Save' | translate }}
      </button>
      <button mat-raised-button color="primary" (click)="toCharacters()" i18n>
        <em class="material-icons">arrow_back</em>
        {{ 'Common.Back' | translate }}
      </button>
    </mat-card-actions>
  </mat-card>
</ng-template>
